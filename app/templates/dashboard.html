{% extends "base.html" %}

{% block title %}Dashboard - Multi-Asset Strategy{% endblock %}

{% block content %}
<div class="page-header">
    <div class="container">
        <h1 class="page-title">Strategy Dashboard</h1>
        <p class="page-subtitle">EMA 126-day Trend-Following | 2005-2025 | 20-Year Backtest</p>
    </div>
</div>

<div class="container">
    <!-- Production Ready Alert -->
    <div class="success-box">
        <h5><strong>✅ PRODUCTION READY</strong></h5>
        <p class="mb-0">Strategy validated across 20 years. Sharpe 0.82, Total Return 592.6%, Max Drawdown -23.9%. Robust design with minimal overfitting risk (CV 5.5%).</p>
    </div>

    <!-- Key Metrics Row -->
    <div class="row mb-4">
        <div class="col-md-3">
            <div class="metric-card" data-bs-toggle="tooltip" data-bs-placement="top" title="Cumulative return from $100 initial investment over the entire backtest period">
                <div class="metric-label">Total Return <span style="font-size: 0.8rem; color: #3498DB;">ℹ️</span></div>
                <div class="metric-value positive">{{ "%.1f"|format(metrics.total_return * 100) }}%</div>
                <div class="metric-change text-success">
                    +{{ "%.1f"|format(improvements.return) }}% vs B&H
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="metric-card" data-bs-toggle="tooltip" data-bs-placement="top" title="Sharpe Ratio: Risk-adjusted return. Higher is better. Above 1.0 is excellent. Measures return per unit of risk.">
                <div class="metric-label">Sharpe Ratio <span style="font-size: 0.8rem; color: #3498DB;">ℹ️</span></div>
                <div class="metric-value neutral">{{ "%.3f"|format(metrics.sharpe_ratio) }}</div>
                <div class="metric-change text-success">
                    +{{ "%.3f"|format(improvements.sharpe) }} vs B&H
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="metric-card" data-bs-toggle="tooltip" data-bs-placement="top" title="Maximum Drawdown: Largest peak-to-trough decline. Lower (closer to 0) is better. Measures worst-case loss.">
                <div class="metric-label">Max Drawdown <span style="font-size: 0.8rem; color: #3498DB;">ℹ️</span></div>
                <div class="metric-value negative">{{ "%.2f"|format(metrics.max_drawdown * 100) }}%</div>
                <div class="metric-change text-success">
                    {{ "%.1f"|format(improvements.dd) }}% better than B&H
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="metric-card" data-bs-toggle="tooltip" data-bs-placement="top" title="Calmar Ratio: Annual return divided by max drawdown. Higher is better. Measures return per unit of downside risk.">
                <div class="metric-label">Calmar Ratio <span style="font-size: 0.8rem; color: #3498DB;">ℹ️</span></div>
                <div class="metric-value neutral">{{ "%.3f"|format(metrics.calmar_ratio) }}</div>
                <div class="metric-change text-muted">
                    Return / Max DD
                </div>
            </div>
        </div>
    </div>

    <!-- Second Row of Metrics -->
    <div class="row mb-4">
        <div class="col-md-3">
            <div class="metric-card" data-bs-toggle="tooltip" data-bs-placement="top" title="Annualized Return (CAGR): Compound annual growth rate over the full period. Average yearly return.">
                <div class="metric-label">Annualized Return <span style="font-size: 0.8rem; color: #3498DB;">ℹ️</span></div>
                <div class="metric-value positive">{{ "%.2f"|format(metrics.annualized_return * 100) }}%</div>
                <div class="metric-change text-muted">
                    20-year CAGR
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="metric-card" data-bs-toggle="tooltip" data-bs-placement="top" title="Sortino Ratio: Like Sharpe but only penalizes downside volatility. Higher is better. More relevant for risk-averse investors.">
                <div class="metric-label">Sortino Ratio <span style="font-size: 0.8rem; color: #3498DB;">ℹ️</span></div>
                <div class="metric-value neutral">{{ "%.3f"|format(metrics.sortino_ratio) }}</div>
                <div class="metric-change text-muted">
                    Downside risk-adjusted
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="metric-card" data-bs-toggle="tooltip" data-bs-placement="top" title="Volatility: Standard deviation of returns. Lower is more stable. Measures how much returns fluctuate.">
                <div class="metric-label">Volatility <span style="font-size: 0.8rem; color: #3498DB;">ℹ️</span></div>
                <div class="metric-value neutral">{{ "%.2f"|format(metrics.annualized_volatility * 100) }}%</div>
                <div class="metric-change text-muted">
                    Annualized std dev
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="metric-card" data-bs-toggle="tooltip" data-bs-placement="top" title="Win Rate: Percentage of days with positive returns. Higher is better but not critical (big wins can offset losses).">
                <div class="metric-label">Win Rate <span style="font-size: 0.8rem; color: #3498DB;">ℹ️</span></div>
                <div class="metric-value neutral">{{ "%.1f"|format(metrics.win_rate * 100) }}%</div>
                <div class="metric-change text-muted">
                    Positive days
                </div>
            </div>
        </div>
    </div>

    <!-- Main Chart -->
    <div class="row">
        <div class="col-md-9">
            <div class="chart-container">
                <h4 class="mb-3">Cumulative Returns</h4>
                {{ cumulative_chart|safe }}
            </div>
        </div>
        <div class="col-md-3">
            <div class="chart-container">
                <h5 class="mb-3">Current Holdings</h5>
                {{ holdings_chart|safe }}
                <div class="mt-3">
                    <h6>Active Positions: <span class="badge bg-primary">{{ num_positions }}</span></h6>
                    <ul class="list-group list-group-flush small">
                        {% for asset in active_positions %}
                        <li class="list-group-item">{{ asset }}: {{ "%.1f"|format(100 / num_positions) }}%</li>
                        {% endfor %}
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <!-- Recent Performance -->
    <div class="row">
        <div class="col-md-4">
            <div class="metric-card">
                <div class="metric-label">Last 30 Days</div>
                <div class="metric-value {% if last_30d > 0 %}positive{% else %}negative{% endif %}">
                    {{ "%+.2f"|format(last_30d * 100) }}%
                </div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="metric-card">
                <div class="metric-label">Last 90 Days</div>
                <div class="metric-value {% if last_90d > 0 %}positive{% else %}negative{% endif %}">
                    {{ "%+.2f"|format(last_90d * 100) }}%
                </div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="metric-card">
                <div class="metric-label">Year-to-Date</div>
                <div class="metric-value {% if ytd > 0 %}positive{% else %}negative{% endif %}">
                    {{ "%+.2f"|format(ytd * 100) }}%
                </div>
            </div>
        </div>
    </div>

    <!-- Quick Info -->
    <div class="row mt-4">
        <div class="col-md-12">
            <div class="info-box">
                <h5><strong>Strategy Configuration</strong></h5>
                <ul class="mb-0">
                    <li><strong>Signal:</strong> EMA 126-day (6-month exponential moving average)</li>
                    <li><strong>Position Sizing:</strong> Equal weight (1/N) across active signals</li>
                    <li><strong>Rebalancing:</strong> Monthly (end of month)</li>
                    <li><strong>Transaction Costs:</strong> 5 basis points per trade</li>
                    <li><strong>Universe:</strong> SPY, TLT, GLD, DBC, VNQ (5 assets)</li>
                </ul>
            </div>
        </div>
    </div>
</div>

<!-- Initialize Bootstrap tooltips -->
<script>
    document.addEventListener('DOMContentLoaded', function() {
        var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'))
        var tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
            return new bootstrap.Tooltip(tooltipTriggerEl)
        })
    });
</script>
{% endblock %}
