# src/diagnostics/ - 实验验证框架

## 文件说明

| 文件 | 行数 | 功能 | 结果 |
|------|------|------|------|
| `experiment_03_carry.py` | ~644 | Carry信号验证 (IC测试+回测) | FAILED |
| `experiment_05_costs.py` | ~580 | 交易成本敏感性 (3场景+动态+盈亏平衡) | FAIL* |
| `experiment_07_stability.py` | ~430 | 参数稳定性滚动验证 (8 spans × 12 windows) | FAIL* |

## 实验矩阵 (10个计划, 3个完成)

| ID | 名称 | 优先级 | 状态 |
|----|------|--------|------|
| 1 | 协方差估计稳定性 | P0 | 未实现 |
| 2 | 波动率预测精度 | P0 | 未实现 |
| 3 | Carry信号验证 | P1 | **FAILED** (IC=-0.031) |
| 4 | Momentum崩盘风险 | P1 | 未实现 |
| 5 | 交易成本影响 | P0 | **FAIL*** (合成数据) |
| 6 | 策略拥挤度 | P1 | 未实现 |
| 7 | 参数稳定性 | P0 | **FAIL*** (合成数据) |
| 8 | Regime非平稳性 | P1 | 未实现 |
| 9 | 杠杆约束 | P2 | 未实现 |
| 10 | 样本外泛化 | P2 | 未实现 |

\* FAIL标注使用合成数据运行，需用真实市场数据重新验证

## 实验模板 (参见 RESEARCH_PROTOCOL.md)

每个实验必须包含:
1. Walk-forward 声明 (Train/Val/Test 日期)
2. 失败标准 (实验前定义)
3. 成本场景 (三档: 5/12/25 bps)
4. 自动失败检测
5. JSON 输出到 `outputs/experiments/`

## Exp3 失败摘要

- Mean IC = -0.031 (阈值 >0.10)
- 4个失败标准全部触发
- 根因: 代理变量 (短期动量/滚动收益率) 无法替代真实carry数据

## 变更日志

### 2026-02-07: 初始创建
- **变更**: 创建目录说明文件
- **教训**: 10个实验仅完成1个是最大风险；P0 实验 (Exp 1/2/5/7) 应优先完成以确认策略生存能力

### 2026-02-08: Phase 0 — Exp 05 + Exp 07 实现
- **变更**: 新增 `experiment_05_costs.py` 和 `experiment_07_stability.py`
- **Exp 05**: 4个固定成本场景 (0/5/12/25 bps) + 动态波动率调整成本模型 + 盈亏平衡分析
  - 盈亏平衡 ~69 bps (Sharpe=0 处), 策略有成本缓冲空间
  - FAIL: 合成数据下 Sharpe@12bps=0.31 < 0.50 阈值
- **Exp 07**: 8个 EMA span × 12个滚动窗口 (5y train + 2y val)
  - 最优 span 在 42-378 之间波动 (ratio=9x > 2x 阈值)
  - FAIL: 合成数据下 126d 仅 16.7% 时间进入 top-3
- **教训**: 合成数据结果仅验证代码正确性, 不代表策略结论; 需真实数据重跑
